<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>The Pond - Zolmeister</title>
    <meta name="description" content="Zolmeister- Blog" />
    <link href='http://zolmeister.com/favicon.ico' rel='icon' type='image/x-icon'/>

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <!-- This is for syntax highlight -->
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Zolmeister - Atom" href="http://www.zolmeister.com/feeds/posts/default" />
    <link rel="alternate" type="application/rss+xml" title="Zolmeister - RSS" href="http://www.zolmeister.com/feeds/posts/default?alt=rss" />

</head>
<body class="home-template">


    <main class="content" role="main">

    <article class="post">
        <header class="post-header">
            <a id="blog-logo" href="/">
                
                    <span class="blog-title">Zolmeister</span>
                
            </a>
        </header>

        <span class="post-meta">
        	<time datetime="2013-10-15">15 Oct 2013</time>
        	<!--
        		on
	        	
	        -->
       	</span>

        <h1 class="post-title"><a href="">The Pond</a></h1>

        <section class="post-content">
            <p><a href="http://thepond.zolmeister.com/"><img src="http://4.bp.blogspot.com/-clTSEFA6cpA/UlcE3Rjk9UI/AAAAAAAAAp0/6m_tJC8GrJ0/s1600/screenshot-menu-640-400.png" alt=""></a></p>

<h4>Update:</h4>

<p>Read my guest post on&nbsp;<a href="https://hacks.mozilla.org/2013/11/the-pond-building-a-multi-platform-html5-game/">Mozilla Hacks</a></p>

<h4>Check out <a href="http://thepond.zolmeister.com/"><strong>The Pond</strong></a>&nbsp;(<a href="https://github.com/Zolmeister/pond">Source</a>&nbsp;-&nbsp;GPL) on:</h4>

<p><a href="https://play.google.com/store/apps/details?id=com.Zolmeister.ThePond" imageanchor="1" style="margin-left: 1em; margin-right: 1em;float:left" target="_blank">
<img alt="Google Play" border="0" src="http://4.bp.blogspot.com/-cPl79M_hD18/UlmrBIx0XrI/AAAAAAAAAqs/hl6MfbFZWFI/s1600/play-store-icon.png" title="Google Play">
</a>
<a href="https://chrome.google.com/webstore/detail/the-pond/aonjkompolbfgipkpgmcgiakfghibjmm" imageanchor="1" style="margin-left: 1em; margin-right: 1em;float:left" target="_blank">
<img alt="Chrome Store" border="0" src="http://1.bp.blogspot.com/-SrpGXzQgk2w/UlmrFZ6xLfI/AAAAAAAAAq0/Sgx3BnEddh8/s1600/chrome-store.png" title="Chrome Store">
</a>
<a href="http://www.amazon.com/Zolmeister-The-Pond/dp/B00FROOKHI" imageanchor="1" style="margin-left: 1em; margin-right: 1em;float:left" target="_blank">
<img alt="Amazon App Store" border="0" src="http://1.bp.blogspot.com/-O77qDjuQ2as/UlmrJ9J2nnI/AAAAAAAAAq8/JcDbIGnWAjw/s1600/amazon-app-store-app.png" title="Amazon App Store">
</a>
<a href="https://marketplace.firefox.com/app/the-pond/" imageanchor="1" style="margin-left: 1em; margin-right: 1em;" target="_blank">
<img alt="Firefox Marketplace" border="0" src="http://4.bp.blogspot.com/-kIy9Qf9ks0Y/UlmqRdpFQGI/AAAAAAAAAqo/QyVriwr-zig/s1600/firefox-marketplace.png" title="Firefox Marketplace">
</a></p>

<p>also on&nbsp;<a href="http://clay.io/game/thepond">clay.io</a>, <a href="http://apps.facebook.com/inthepond">FB (http)</a>, <a href="https://www.pokki.com/app/The-Pond">Pokki</a></p>

<p>Tools used: <a href="http://www.lighttable.com/">LightTable IDE</a>, <a href="http://www.ludei.com/tech/cocoonjs">CocoonJS</a></p>

<p>The Pond - because quality trumps quantity.</p>

<p>Before I go into some of the highlights of The Pond in code, I would like to give credit to both LightTable and CocoonJS for making the experience so enjoyable and awesome.</p>

<p><a href="http://www.lighttable.com/">LightTable</a> is a javascript IDE which started out as a concept video, and turned into a successful <a href="http://www.kickstarter.com/projects/ibdknox/light-table">Kickstarter</a>. &nbsp;The most amazing feature of LightTable is it&#39;s code injection - as you edit javascript, you can update the javascript interpreted by V8 in the browser in real-time (<a href="http://www.youtube.com/watch?v=gtXpOD6jFls">video</a>), which is an extremely powerful tool when developing a game where dealing with full page reloads can be cumbersome.</p>

<p><a href="http://4.bp.blogspot.com/-L_jM7rzHhi4/UljxPJSutUI/AAAAAAAAAqM/229Poch2jTo/s1600/icon-90.png"><img src="http://4.bp.blogspot.com/-L_jM7rzHhi4/UljxPJSutUI/AAAAAAAAAqM/229Poch2jTo/s1600/icon-90.png" alt=""></a></p>

<p><a href="http://www.ludei.com/tech/cocoonjs">CocoonJS</a> is a mobile platform for deploying HTML5 canvas games to mobile. It has implemented the javascript canvas in OpenGL for faster performance on mobile, and it also makes deploying the application to many platforms extremely simple (just tick a few check-boxes and you get a compiled version of the app for 4 different platforms).</p>

<p>One of the most important features of The Pond is that it&#39;s completely fluid and dynamic. No matter what screen size, be it a full screen desktop or low resolution mobile, The Pond dynamically adjusts itself flawlessly. Additionally, on mobile it will automatically reduce render quality if it detects a lag in frame rate. It is able to accomplish these things in part because it uses a proper game loop (from this <a href="http://gameprogrammingpatterns.com/game-loop.html">amazing article</a> on game loops):</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">MS_PER_UPDATE</span> <span class="o">=</span> <span class="mi">18</span>
<span class="kd">var</span> <span class="nx">lag</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="kd">var</span> <span class="nx">previousTime</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1">// main game loop</span>
<span class="kd">function</span> <span class="nx">draw</span><span class="p">(</span><span class="nx">time</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">requestAnimFrame</span><span class="p">(</span><span class="nx">draw</span><span class="p">)</span>
  <span class="nx">lag</span> <span class="o">+=</span> <span class="nx">time</span> <span class="o">-</span> <span class="nx">previousTime</span>
  <span class="nx">previousTime</span> <span class="o">=</span> <span class="nx">time</span>

  <span class="kd">var</span> <span class="nx">MAX_CYCLES</span> <span class="o">=</span> <span class="mi">18</span>
  <span class="k">while</span><span class="p">(</span><span class="nx">lag</span> <span class="o">&gt;=</span> <span class="nx">MS_PER_UPDATE</span> <span class="o">&amp;&amp;</span> <span class="nx">MAX_CYCLES</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// user input, movement, and animation calculations</span>
    <span class="nx">physics</span><span class="p">()</span>
    <span class="nx">lag</span> <span class="o">-=</span> <span class="nx">MS_PER_UPDATE</span>
    <span class="nx">MAX_CYCLES</span><span class="o">--</span>
  <span class="p">}</span>

  <span class="c1">// if we exhausted our cycles, the client must be lagging</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">MAX_CYCLES</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// adaptive quality</span>
    <span class="nx">lowerQuality</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="c1">// if 5 frames behind after update, jump</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">lag</span><span class="o">/</span><span class="nx">MS_PER_UPDATE</span> <span class="o">&gt;</span> <span class="mi">75</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">lag</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="p">}</span>

  <span class="c1">// draw to canvas</span>
  <span class="nx">paint</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>The key to this game loop is that it uses a fixed interval physics time-step, and renders to the screen whenever possible. This means that all physics calculations are constant and run in predictable time. This means a fast computer will see the same physics as a slower computer (or in this case mobile device). Then, after the physics has been synced properly (at 60FPS), the actual screen drawing is done. This means that a slower computer will have a lower frame-rate for paint updates (30fps vs 60fps for example), which makes sense because the computer should lag but not break (due to physics time-step differences).</p>

<p><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-YCm9OCAbzoU/UljxHAOaoeI/AAAAAAAAAqE/KDw80eKf0_U/s1600/Selection_042.png"><img src="http://1.bp.blogspot.com/-YCm9OCAbzoU/UljxHAOaoeI/AAAAAAAAAqE/KDw80eKf0_U/s1600/Selection_042.png" alt=""></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Debug Mode</td></tr></tbody></table>One of the most difficult challenges with this project was dealing with collisions. Unlike other games where a box or a circle can model an object mostly accurately, I needed a way to detect collision between two irregular objects efficiently. Originally I thought about color-based pixel testing (really slow), and also doing Bézier curve collision calculations (extremely difficult and computationally expensive). What I ended up doing was hacking it, and just fit 6 circles within the body to do collision tests for each circle to determine whole body collision.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Fish</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">collide</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fish</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// there are 6 circles that make up the collision box of each fish</span>
  <span class="c1">// check if they collide</span>
  <span class="kd">var</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">circles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;)</span> <span class="p">{</span>
    <span class="nx">c1</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">circles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">fish</span><span class="p">.</span><span class="nx">circles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;)</span> <span class="p">{</span>
      <span class="nx">c2</span> <span class="o">=</span> <span class="nx">fish</span><span class="p">.</span><span class="nx">circles</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>

      <span class="c1">// check if they touch</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">distance</span><span class="p">(</span><span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nx">c2</span><span class="p">.</span><span class="nx">r</span> <span class="o">+</span> <span class="nx">c1</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>
<p>Another challenge I faced was dealing with rendering performance on mobile. The most expensive part of the whole painting operation (which was the bottleneck) was drawing the curves for each fish every frame. Normally most application use a sprite sheet to handle character animation (see <a href="http://www.zolmeister.com/2013/09/senshi-mmo-battle-royale-inspired-html5.html">Senshi</a>), however The Pond has many dynamic elements in terms of color and shape based on rotation speed which make using a sprite sheet extremely difficult. So instead of using a sprite sheet, I draw each fish as a combination of Bézier curves.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Fish</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">drawBody</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">fish</span> <span class="o">=</span> <span class="k">this</span>
  <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span>
  <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ctx</span>
  <span class="kd">var</span> <span class="nx">curv</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">curv</span>
  <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">oscillation</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">fish</span><span class="p">.</span><span class="nx">bodyOutline</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">4</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">+=</span><span class="mi">2</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="nx">size</span><span class="p">,</span>
      <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">c1</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="nx">size</span> <span class="o">*</span> <span class="p">(</span><span class="mi">14</span><span class="o">/</span><span class="mi">15</span><span class="p">),</span>
      <span class="nx">y</span><span class="o">:</span> <span class="nx">i</span><span class="o">*</span><span class="nx">size</span> <span class="o">+</span> <span class="nx">size</span><span class="o">/</span><span class="mi">30</span><span class="o">*</span><span class="nx">o</span> <span class="o">+</span> <span class="nx">curv</span><span class="o">/</span><span class="mi">3</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">c2</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="nx">size</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
      <span class="nx">y</span><span class="o">:</span> <span class="nx">i</span><span class="o">*</span><span class="nx">size</span> <span class="o">+</span> <span class="nx">size</span><span class="o">/</span><span class="mi">30</span><span class="o">*</span><span class="nx">o</span> <span class="o">+</span> <span class="nx">curv</span><span class="o">/</span><span class="mi">2</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="nx">size</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
      <span class="nx">y</span><span class="o">:</span> <span class="nx">i</span><span class="o">*</span><span class="nx">size</span><span class="o">/</span><span class="mi">3</span> <span class="o">+</span> <span class="nx">size</span><span class="o">/</span><span class="mi">15</span><span class="o">*</span><span class="nx">o</span> <span class="o">+</span> <span class="nx">curv</span>
    <span class="p">}</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">start</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">start</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="nx">c1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">c1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">c2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">c2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">end</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">end</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">c3</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="nx">size</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">,</span>
      <span class="nx">y</span><span class="o">:</span> <span class="nx">i</span><span class="o">*</span><span class="nx">size</span><span class="o">/</span><span class="mi">6</span> <span class="o">+</span> <span class="nx">size</span><span class="o">/</span><span class="mi">10</span><span class="o">*</span><span class="nx">o</span> <span class="o">+</span> <span class="nx">curv</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">c4</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="nx">size</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span>
      <span class="nx">y</span><span class="o">:</span> <span class="nx">i</span><span class="o">*</span><span class="nx">size</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="nx">size</span><span class="o">/</span><span class="mi">15</span><span class="o">*</span><span class="nx">o</span> <span class="o">+</span> <span class="nx">curv</span><span class="o">/</span><span class="mi">2</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">end2</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="nx">size</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span>
      <span class="nx">y</span><span class="o">:</span> <span class="o">-</span><span class="nx">size</span><span class="o">/</span><span class="mi">15</span><span class="o">*</span><span class="nx">o</span> <span class="o">+</span> <span class="nx">curv</span><span class="o">/</span><span class="mi">3</span>
    <span class="p">}</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="nx">c3</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">c3</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">c4</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">c4</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">end2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">end2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

<span class="p">}</span>
</code></pre></div>
<p>Now, this code could be optimized slightly by removing the new objects being created ({} generates a new object), however based on testing the biggest performance culprit is the bezierCurveTo() call, and having clean code takes priority over a micro-optimization. <code>this.oscillation</code> is based on a sin wave, and <code>this.curv</code> is based on distance to current rotation target. Overall, I was quite pleased with the rendering performance of the app. For more details, check out the <a href="https://github.com/Zolmeister/pond/commits/master">commit log</a> on github where you can find the commits which made the biggest performance improvements.</p>

<p>Lastly, I had a good bit of trouble figuring out how to get the fish to turn toward a target direction in the most efficient manner (take the shortest path around the unit circle). I eventually came up with this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">directionTowards</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">dir</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dir</span>
<span class="kd">var</span> <span class="nx">targetDir</span> <span class="o">=</span> <span class="nx">directionTowards</span><span class="p">(</span><span class="nx">MOUSE</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">arcSpeed</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">arcSpeed</span>

<span class="c1">// should it turn left or right? (based on shortest distance)</span>
<span class="kd">var</span> <span class="nx">arcDirection</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1">// if the arc distance is greater than 180deg, turn the other way</span>
<span class="k">if</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dir</span><span class="o">-</span><span class="nx">targetDir</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">arcDirection</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="p">}</span>

<span class="c1">// prevent over-turning</span>
<span class="kd">var</span> <span class="nx">moveDistance</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">arcSpeed</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dir</span><span class="o">-</span><span class="nx">targetDir</span><span class="p">))</span>

<span class="c1">// do the actual rotation</span>
<span class="k">this</span><span class="p">.</span><span class="nx">dir</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">dir</span> <span class="o">&gt;</span> <span class="nx">targetDir</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">arcDirection</span> <span class="o">*</span> <span class="nx">moveDistance</span>

<span class="c1">// normalize dir within range( -PI &lt; dir &lt; PI )</span>
<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dir</span><span class="o">&gt;</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dir</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dir</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mi">2</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dir</span><span class="o">&lt;-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dir</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dir</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mi">2</span>
<span class="p">}</span>
</code></pre></div>
<p>Bonus: I tried to integrate a <a href="http://en.wikipedia.org/wiki/Metaballs">metaballs</a> effect into the game, but it didn&#39;t work out. Check out this jsfiddle for a great example of <a href="http://jsfiddle.net/loktar/TscNZ/">metaballs</a> (<a href="http://www.somethinghitme.com/2012/06/06/2d-metaballs-with-canvas/">blog post</a>).</p>

<p>Update (Sep 11, 2014): <a href="https://www.youtube.com/watch?v=azqBULCfAFk">Inspirational Video</a></p>

        </section>

        

        <footer class="post-footer">
        	<!-- If we want to display author's name and bio -->
            
                <section class="author">
                	<header> <a href=""> <img class="profile" src="/assets/images/profile.png" alt="Zolmeister"></a></header>
                	<article>
                		<!-- Author Name -->
                    	<h4> Zoli Kahan </h4>
                    	<!-- Author Bio -->
                    	<p>
                    		<a target="_blank" href="http://insignia.zolmeister.com">Projects</a> |
                        <a target="_blank" href="https://github.com/Zolmeister">GitHub</a> |
                        <a target="_blank" href="http://clay.io">Clay.io</a>
                    	</p>
                    </article>
                </section>
            

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=The Pond&amp;url=http://zolmeister.com/2013/10/the-pond.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://zolmeister.com/2013/10/the-pond.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://zolmeister.com/2013/10/the-pond.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

            
            <section class="disqus">
        	    <div id="disqus_thread"></div>
              <script type="text/javascript">
                  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                  var disqus_shortname = 'zolmeister'; // required: replace example with your forum shortname

                  /* * * DON'T EDIT BELOW THIS LINE * * */
                  (function() {
                      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
              </script>

            </section>
            

        </footer>

    </article>

</main>


    <footer class="site-footer">
        <a class="subscribe icon-feed" href="feeds/posts/default"><span class="tooltip">Subscribe!</span></a>
        <div class="inner">
             <section class="copyright">All content copyright <a href="">Zolmeister</a> &copy;  &bull; All rights reserved.</section>
        </div>
    </footer>


    <script type="text/javascript" src="/assets/js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-30570115-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</body>
</html>
